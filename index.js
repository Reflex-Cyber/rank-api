require('dotenv').config();
const express = require('express');
const noblox = require('noblox.js');
const app = express();
const cookie = "_|WARNING:-DO-NOT-SHARE-THIS.--Sharing-this-will-allow-someone-to-log-in-as-you-and-to-steal-your-ROBUX-and-items.|_67F77DED6BBB6618308836DC434C515CDEFCB873DC6E7486334BF4ABEBE1B34770575C1FA77D4F0401F03E77F5578B98E6853D002232E8634573CCC14C7AABA4190789D18CEFF17CF40CD7F1DC6D8973BD90CB46866B9292AEB5ACA8972EBED475CB0B30FE82871482E6930D1050B18CC5723F95EED272B9EBAD9188B6B64F169D41C0C6195D880D974E1846DFC9713AFAAC025CE404A3A87061202B3C67413F60E0209ADC7CD11D11ADF87A2D3EE8C302F5708F7743C048B9A64788E0DC7BF0F814C40ECEFB9C997FE4B0F5041739F0465FB85470BED7953FDAF5553454D6B018FB3339C4BDCA5E94FEB45ACBF20E7F5B8189758AF86654BB6661AA733B0C0E2BF46AAAD3056EDF4FE2871978BCA755C4BCAB8BF58D99C1E03AA250001F60C356A97B8A00DB980812E3EA1152207CA437FAEAF61556BC757AF4F878EF4134EDC5952369E8412295C904C8237DE44FF865576ACA40E796CC79256A856FC25841E118E9492E676AB3651DC8FD6AC1325981663C2DDF5ADA3CACDE3F7B415B5D6C730F52BF2B6BD70B084F281A08DEBBF296C3FCB46D5F535FA5CE51FBFA14A241C68D2ACFB899C6495B2379BFB812EC368C4558D64A8E338B14154950E160781D575F3D5D9EBBCD021D3666D8A6A55E791D207F93D45622CDDB3F8381C6C7F46A11F6DB1E38603B57BCE81F8E87EC9AFB27D6D6BC3C6A80AC5BF409DAC5EB4E68DCE39667696B7AA216665BBB1A5BF0B9EEBD4A5F4BAF621DD4B119806F1D6EE4DA0EC40CA579BE56F615015096729A705BE6994009BDCD3D7E6E0873CA29E1BF3BA4E57362754B827EEB0739325E02332CFA56F50FA1B835B45D73D0B99457423E7DE61E3109777E89102D10CB8F28ECDC67F2CFA86134E60B6EF85A335D6B6E82636BD03576C8BAF00AE2D1DAF3E551107FAD16F44445442F83B3A9026952FBBDC3B7C738D204771C1C7535FEF55C05F2B2ADFA070B38C67D2982FEACEB59195A3A65509F6FB70C6A29012E87264126CAA0AA3A1A976E066D594B59FA16C6DC8B12F4091008971DA7E63BA74FBE6A8F05B5C18DDC2475629C6F57480D71F80652EEB45425B7DDF813492033505482571796F0B5D50C6C8F00109380EA3C390DCA6A949B"

app.use(express.json());

app.use(async (req, res, next) => {
    if (!cookie) {
        return res.status(400).json({ error: "Cookie not set" });
    }

    await noblox.setCookie(cookie);
    let currentUser = await noblox.getCurrentUser();
    console.log(`Logged in as ${currentUser.UserName}`);
    next();
});

app.post("/ranker", async (req, res) => {
    try {
        const { userid, rank, grupid } = req.body;
        await noblox.setRank(parseInt(grupid), parseInt(userid), parseInt(rank));
        res.json({ message: "Ranked!" });
    } catch (error) {
        console.error(error);
        res.status(500).json({ error: "Internal server error" });
    }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(`Server is up and running on port ${PORT}`);
});
